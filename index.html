<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <title>RoTB</title>
	<script type="text/javascript" src="js/phaser.min.js?n=1"></script>
    <style type="text/css">
        body {
            margin: 0;
            background: #333;
        }
    </style>
</head>
<body>
<div style="width: 60%; margin: 0px auto;">

<script type="text/javascript">

var game = new Phaser.Game(640, 960, Phaser.AUTO, 'ROTB', { preload: preload, create: create, update: update });

var text;


//------------------!!!!!!-----------------J ÄR X POS ----------- I ÄR Y POS----------!!!! -------------------//

var BARREL_REVEAL_ABOVE = 'Barrel Reveal Above';
var BARREL_REVEAL_BELOW = 'Barrel Reveal Below';
var BARREL_CHARGE = 'Barrel Charge';
var BARREL_MOVE_ROW_BELOW = 'Barrel Move Row Below';
var BARREL_MOVE_ROW_LEFT = 'Barrel Move Row To The left';

var BOARD_COLS;
var BOARD_ROWS;
var counter = 0;

var TEST_CONSTANT = 6;
var BARREL_WIDTH = 80;
var BARREL_HEIGHT = 100;

var ADD_BARREL_UP = 1;
var ADD_BARREL_DOWN = 2;
var MOVE_ROW_BELLOW = 3;
var MOVE_ROW_LEFT = 4;
var CHARGE = 5;


var gameBoard;





var selectedbarrel;
var selectedBarrelStartPos;
var selectedBarrelTween;
var tempShiftedBarrel;
var tempShiftedBarrelTween;
var allowInput;


function preload() {
	console.log('preload');
   /* game.load.image('background', 'assets/bg.png');
    game.load.image('barrel', 'assets/barrel_base_small_101_128.png');
    game.load.image('barrel2', 'assets/barrel_BLUE_TEST_51_64.png');
    game.load.image('barrel3', 'assets/barrel_BLUE_TEST_101_128.png');
    game.load.image('spriteMoveRowLeft', 'assets/barrel_BLUE_TEST_76_96.png');
    game.load.image('spriteRevealAbove', 'assets/barrel_reveal_up_green_76_96.png');
    game.load.image('spriteCharge', 'assets/barrel_charge_yellow_76_96.png');
*/	
	game.load.spritesheet('barrel_sheet', '/assets/sprite_sheet.png', 85, 100);


}


function Barrel(barreltype, posx, posy, id, sprite, frameid) {
	this.barrelType = barreltype;
	this.posX = posx;
	this.posY = posy;
	this.barrelId = id;
	this.barrelSprite = sprite;
	this.frameID = frameid;
}


Barrel.prototype.barrelInfo = function() {
	console.log("I am the one and only barrel number:  " + this.barrelId + "  My posy is:  " + this.posX + "-" + this.posY + "  I am a mother fucking: " + this.barrelType);
}

function create() {

    //  A simple background for our game

    var barrel1 = new Barrel('typ1', 3, 6, 1);
 

	console.log('create');
  //	game.add.sprite(0, 0, 'background');

    text = game.add.text(250, 16, '', { fill: '#ffffff' });
    gameBoard = new Array(6);
    for(var i = 0; i < TEST_CONSTANT; i++)
    	gameBoard[i] = new Array(6);


 //   gameBoard[4][5] = "ras är fedt fin";
   // console.log(gameBoard[4][5]);

   	spawnBoard();



}

function update() {
	//console.log('update');

}

function spawnBoard() {
	
	console.log('spawnboard()');

	for (var i = 0; i < TEST_CONSTANT; i++) {
		for(var j = 0; j < TEST_CONSTANT; j++) {
			var barrel;
			var rand = Math.round(Math.random()*2);
			if(rand === 0) {
				barrel = game.add.sprite(i*BARREL_WIDTH, j*BARREL_HEIGHT, 'barrel_sheet', 0);
				
				gameBoard[i][j] = new Barrel(BARREL_MOVE_ROW_LEFT, j, i, counter, barrel, 0);
			} else if (rand === 1) {
				barrel = game.add.sprite(i*BARREL_WIDTH, j*BARREL_HEIGHT, 'barrel_sheet',2);
				gameBoard[i][j] = new Barrel(BARREL_REVEAL_ABOVE, j, i, counter, barrel, 2);
			} else {
				barrel = game.add.sprite(i*BARREL_WIDTH, j*BARREL_HEIGHT, 'barrel_sheet', 1);
				gameBoard[i][j] = new Barrel(BARREL_CHARGE, j, i, counter, barrel, 1);
			}

			
		
			barrel.inputEnabled = true;

            if(barrel.alpha == true) {
			    gameBoard[i][j].barrelSprite.events.onInputDown.add(listener,gameBoard[i][j]);
            }
            counter++;
		}
	}
}

function listener() {
	counter++;
	//this.barrelInfo();
	//console.log(this.barrelType);
	var expr = this.barrelType;
	switch(expr) {
		
		case BARREL_REVEAL_ABOVE:
			showBarrelAbove();
			break;

		case BARREL_REVEAL_BELOW:
			showBarrelBellow();
			break;

		case BARREL_MOVE_ROW_BELOW:
			moveRowBellow();
			break;

		case BARREL_MOVE_ROW_LEFT:
			moveRowLeft(this);
			break;

		case BARREL_CHARGE:
			addCharge();
			break;
	}


}

function showBarrelAbove() {
	console.log('shwo above!');
}

function showBarrelBellow () {
	console.log('show bellow!');
}

function moveRowBellow () {
	console.log('move bellow!');
}

function moveRowLeft (tmpBarrel) {
	//console.log(tmpBarrel.barrelSprite.key);

	//gameBoard[0][0].barrelSprite.loadTexture(tmpBarrel.barrelSprite.key);
	
	var tmpPosx = tmpBarrel.posX;
	var tmpPosy = tmpBarrel.posY;
	var tmp = new Barrel(tmpBarrel.barrelType, tmpBarrel.posX, tmpBarrel.posY, tmpBarrel.barrelId, tmpBarrel.barrelSprite, tmpBarrel.frameID);
	//console.log(tmp.barrelSprite);
	//var test = tmp.barrelSprite.key;
	
	/*console.log(gameBoard[0][4] === tmp);

	//console.log('innan');
	//console.log(tmp.spriteKey);
	//console.log(tmp === test);
	gameBoard[0][4].barrelSprite.frame = gameBoard[1][4].frameID;
	gameBoard[0][4] = gameBoard[1][4];

	gameBoard[1][4].barrelSprite.frame = gameBoard[2][4].frameID;
	gameBoard[1][4] = gameBoard[2][4];

	gameBoard[2][4].barrelSprite.frame = gameBoard[3][4].frameID;
	gameBoard[2][4] = gameBoard[3][4];

	gameBoard[3][4].barrelSprite.frame = gameBoard[4][4].frameID;
	gameBoard[3][4] = gameBoard[4][4];

	gameBoard[4][4] = gameBoard[5][4];
	gameBoard[4][4].barrelSprite.frame = gameBoard[5][4].frameID;

	gameBoard[5][4].barrelSprite.frame = tmp.frameID;
	gameBoard[5][4] = tmp;
*/
	///console.log(tmp.spriteKey);
	//console.log(gameBoard[4][4].spriteKey);
	//console.log(tmp === test);
	//printRow(tmpPosx+1);
	for(i = 0; i < TEST_CONSTANT; i++)
	{
		//console.log('hehe');
		if(i == TEST_CONSTANT-1)
		{	
			console.log(tmp.frameID);
			console.log(gameBoard[i][tmpPosx+1].frameID);
			gameBoard[i][tmpPosx+1].barrelSprite.frame = tmp.frameID;
			gameBoard[i][tmpPosx+1] = tmp;
			console.log(gameBoard[i][tmpPosx+1].frameID);

		} else {
			//console.log('jag aer: ' + i + "," + (tmpPosx+1) + "  ska bli: " + (i+1) + ',' + (tmpPosx+1));

			gameBoard[i][tmpPosx+1].barrelSprite.frame = gameBoard[i+1][tmpPosx+1].frameID;
			//console.log(gameBoard[i][tmpPosx+1]);
			gameBoard[i][tmpPosx+1] = gameBoard[i+1][tmpPosx+1];
			//console.log(gameBoard[i][tmpPosx+1]);

			//updateBarrelInfo();
		}

	}
//	console.log(tmpBarrel.barrelSprite);
	//console.log('efter');
	//printRow(tmpPosx+1);
}

function addCharge () {
	console.log('add charge!');
}

function uppdateBarrelInfo() {
	console.log('ska uppdatera info');
}

function printRow(rowId) {
	for (var i = 0; i < TEST_CONSTANT; i++) {
   		gameBoard[i][rowId].barrelInfo();
   	}
}

function printCol(colId) {

   	for (var i = 0; i < TEST_CONSTANT; i++) {
   		gameBoard[colId][i].barrelInfo();
   	}
}

function printBoard() {
	for (var j = 0; j < TEST_CONSTANT; j++) {
   	for (var k = 0; k < TEST_CONSTANT; k++) {
   			gameBoard[j][k].barrelInfo();

   		}
   	}
}
</script>
</div>
</body>
</html>