<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8"/>
    <title>RoTB</title>
    <link rel="stylesheet" media="screen" href="css/style.css">
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
            background: #333;
        }
    </style>
</head>
<body>


<script type="text/javascript">

var game = new Phaser.Game(640, 960, Phaser.AUTO, 'gameCentered', { preload: preload, create: create, update: update });

//------------------!!!!!!-----------------J ÄR X POS ----------- I ÄR Y POS----------!!!! -------------------//

var BARREL_REVEAL_ABOVE = 'Barrel Reveal Above';
var BARREL_REVEAL_BELOW = 'Barrel Reveal Below';
var BARREL_REVEAL_LEFT = 'Barrel Reveal Left';
var BARREL_REVEAL_RIGHT = 'Barrel Reveal Right';
var BARREL_CHARGE = 'Barrel Charge';
var BARREL_MOVE_COL_UP = 'Barrel Move Col Up';
var BARREL_MOVE_COL_DOWN = 'Barrel Move Col Down';
var BARREL_MOVE_ROW_LEFT = 'Barrel Move Row To The Left';
var BARREL_MOVE_ROW_RIGHT = 'Barrel Move Row To The Right';
var BARREL_EMPTY = 'Barrel Empty';
var BARREL_WIN = 'Barrel Win';

var BOARD_COLS;
var BOARD_ROWS;
var counter = 0;

var TEST_CONSTANT = 6;
var BARREL_WIDTH = 80;
var BARREL_HEIGHT = 100;

var ADD_BARREL_UP = 1;
var ADD_BARREL_DOWN = 2;
var MOVE_ROW_BELLOW = 3;
var MOVE_ROW_LEFT = 4;
var CHARGE = 5;

var gameBoard;
var level1Board;

var winBarrelCol;
var winBarrelRow;

var selectedbarrel;
var selectedBarrelStartPos;
var selectedBarrelTween;
var tempShiftedBarrel;
var tempShiftedBarrelTween;
var allowInput;

var bClick;

var fileText;

var menuButton1;
var menuButton2;
var menuButton3;
var menuButton4;

 
/*-----------------------------CLASS BARREL ---------------------*/
function Barrel(_barreltype, _posx, _posy, _id, _sprite, _charge, _visible) {
	this.barrelType = _barreltype;
	this.posX = _posx;
	this.posY = _posy;
	this.barrelId = _id;
	this.barrelSprite = _sprite;
	this.charges = _charge;
    this.visible = _visible;
}

Barrel.prototype.barrelInfo = function() {
	console.log("BarrelId:  " + this.barrelId + "  row:  " + this.posX + " col: " + this.posY + "  Type: " + this.barrelType + " Charges: " + this.charges + " visible: " + this.visible);
}
/*-------------------------------------------------------------*/

function Button(_buttonType, _sprite) {
	this.buttonType = _buttonType;
	this.buttonSprite = _sprite;
}


function preload() {
	console.log('preload');
    game.load.image('background', 'assets/bg.png');
    game.load.image('spriteInvisBarrel', 'assets/barrel_invis_76_96.png');
    game.load.image('spriteWinBarrel', 'assets/barrel_win_76_96.png');
    game.load.image('spriteMoveRowLeft', 'assets/barrel_move_row_left_76_96.png');
    game.load.image('spriteMoveRowRight', 'assets/barrel_move_row_right_76_96.png');
    game.load.image('spriteMoveColUp', 'assets/barrel_move_col_up_76_96.png');
    game.load.image('spriteMoveColDown', 'assets/barrel_move_col_down_76_96.png');
    game.load.image('spriteRevealAbove', 'assets/barrel_reveal_up_76_96.png');
    game.load.image('spriteRevealBelow', 'assets/barrel_reveal_below_76_96.png');
    game.load.image('spriteRevealLeft', 'assets/barrel_reveal_left_76_96.png');
    game.load.image('spriteRevealRight', 'assets/barrel_reveal_right_76_96.png');
    game.load.image('spriteCharge', 'assets/barrel_add_charge_76_96.png');

    game.load.audio('sfx', 'assets/sound/barrelclick.wav');

    game.load.text('level1', 'assets/level1.txt');
    game.load.text('level2', 'assets/level2.txt');
    game.load.text('level3', 'assets/level3.txt');
    game.load.text('level4', 'assets/level4.txt');

    game.load.image('buttonl1', 'assets/button_level_1_96_48.png');
    game.load.image('buttonl2', 'assets/button_level_2_96_48.png');
    game.load.image('buttonl3', 'assets/button_level_3_96_48.png');
    game.load.image('buttonl4', 'assets/button_level_4_96_48.png');
}




function create() {

	console.log('create');

	bClick = game.add.audio('sfx');

    text = game.add.text(250, 16, '', { fill: '#ffffff' });
    gameBoard = new Array(6);
    for(var i = 0; i < TEST_CONSTANT; i++)
    	gameBoard[i] = new Array(6);

    emptyBoard();
    showMenu();

  	//emptyBoard();
   	//readLevelsFromFile('level1');
   	//createLevel1();	
   	//spawnBoard();
}

function update() {
	//console.log('update');
}

function levelComplete() {

	//var text = "- Gratz! -\n Level Complete";
    //var style = { font: "65px Arial", fill: "#ffd700", align: "center" };
    //var t = game.add.text(game.world.centerX-280, 0, text, style);
  	//emptyBoard();
    showMenu();

}

function showMenu() {
	resetBoard();
	
	var button1 = game.add.sprite(40, 40, 'buttonl1');
	var button2 = game.add.sprite(40, 108, 'buttonl2');
	var button3 = game.add.sprite(40, 176, 'buttonl3');
	var button4 = game.add.sprite(40, 244, 'buttonl4');

	button1.inputEnabled = true;
	button2.inputEnabled = true;
	button3.inputEnabled = true;
	button4.inputEnabled = true;

	menuButton1 = new Button('level1', button1);
	menuButton2 = new Button('level2', button2);
	menuButton3 = new Button('level3', button3);
	menuButton4 = new Button('level4', button4);

	button1.events.onInputDown.add(menuListener, menuButton1);	
	button2.events.onInputDown.add(menuListener, menuButton2);
	button3.events.onInputDown.add(menuListener, menuButton3);
	button4.events.onInputDown.add(menuListener, menuButton4);
}

function hideMenu() {
	menuButton1.buttonSprite.inputEnabled = false;
	menuButton1.buttonSprite.alpha = false;

	menuButton2.buttonSprite.inputEnabled = false;
	menuButton2.buttonSprite.alpha = false;
	
	menuButton3.buttonSprite.inputEnabled = false;
	menuButton3.buttonSprite.alpha = false;
	
	menuButton4.buttonSprite.inputEnabled = false;
	menuButton4.buttonSprite.alpha = false;

}

function menuListener() {
	console.log(this);	

	var type = this.buttonType;
	switch(type) {

		case 'level1':
			readLevelsFromFile('level1');
			hideMenu();
			break;

		case 'level2':
			readLevelsFromFile('level2');
			hideMenu();
			break;

		case 'level3':
			readLevelsFromFile('level3');
			hideMenu();
			break;

		case 'level4':
			readLevelsFromFile('level4');
			hideMenu();
			break;
	}

}

function readLevelsFromFile(fileName) {
	var tmpFileText = game.cache.getText(fileName);

	fileText = tmpFileText.split('\n');
	var colCounter=0;
	var sign;
	var canSee;
	var fooBarrelSprite;
	var fooBarrelType;
	var fooVisible;
	console.log(fileText);
	for(var i = 0; i < TEST_CONSTANT; i++) {

		for(var j = 0; j < TEST_CONSTANT*2; j++)
		{
			if(j%2 == 0) {
				colCounter++;
				console.log(colCounter);
			}
				
			//console.log(fileText[i][j] + fileText[i][j+1]);
			
			sign = fileText[i][j];
			canSee = 's' == fileText[i][j+1] ? true : false;
			//console.log(invis);
			switch(sign) {

				case '0':
					fooBarrelType = BARREL_EMPTY;
					fooBarrelSprite = 'spriteInvisBarrel';
					fooVisible = canSee;
					break;

				case '>':
					fooBarrelType = BARREL_MOVE_ROW_RIGHT;
					fooBarrelSprite = 'spriteMoveRowRight';
					fooVisible = canSee;
					break;
				
				case '^':
					fooBarrelType = BARREL_MOVE_COL_UP;
					fooBarrelSprite = 'spriteMoveColUp';
					fooVisible = canSee;
					break;
				
				case 'v':
					fooBarrelType = BARREL_MOVE_COL_DOWN;
					fooBarrelSprite = 'spriteMoveColDown';
					fooVisible = canSee;
					break;

				case '<':
					fooBarrelType = BARREL_MOVE_ROW_LEFT;
					fooBarrelSprite = 'spriteMoveRowLeft';
					fooVisible = canSee;
					break;

				case 'a':
					fooBarrelType = BARREL_REVEAL_ABOVE;
					fooBarrelSprite = 'spriteRevealAbove';
					fooVisible = canSee;
					break;

				case 'b':
					fooBarrelType = BARREL_REVEAL_BELOW;
					fooBarrelSprite = 'spriteRevealBelow';
					fooVisible = canSee;
					break;

				case 'r':
					fooBarrelType = BARREL_REVEAL_RIGHT;
					fooBarrelSprite = 'spriteRevealRight';
					fooVisible = canSee;
					break;

				case 'l':
					fooBarrelType = BARREL_REVEAL_LEFT;
					fooBarrelSprite = 'spriteRevealLeft';
					fooVisible = canSee;
					break;
				
				case 'z':
					fooBarrelType = BARREL_CHARGE;
					fooBarrelSprite = 'spriteCharge';
					fooVisible = canSee;
					break;

				case 'w':
					fooBarrelType = BARREL_WIN;
					fooBarrelSprite = 'spriteWinBarrel';
					winBarrelCol = colCounter-1;
					winBarrelRow = i;
					fooVisible = canSee;
					break;
			}
			console.log(winBarrelCol + ' , ' + winBarrelRow);
			gameBoard[colCounter-1][i].visible = canSee;
			gameBoard[colCounter-1][i].barrelSprite.inputEnabled = canSee;
			gameBoard[colCounter-1][i].barrelSprite.alpha = canSee;
			gameBoard[colCounter-1][i].barrelSprite.loadTexture(fooBarrelSprite);
			gameBoard[colCounter-1][i].barrelType = fooBarrelType;
			gameBoard[colCounter-1][i].charges = 2;
			j++;
		}	
		colCounter = 0;	
		
		uppdateBarrelVisibility(i, true);
		
	}
}

function emptyBoard() {
	for (var i = 0; i < TEST_CONSTANT; i++) {
			for(var j = 0; j < TEST_CONSTANT; j++) {
				var barrel;
				
				barrel = game.add.sprite(i*BARREL_WIDTH, j*BARREL_HEIGHT, 'spriteInvisBarrel');
				gameBoard[i][j] = new Barrel(BARREL_EMPTY, j, i, counter, barrel, 2, true);
	            barrel.alpha = true;
				barrel.inputEnabled = true;
	            gameBoard[i][j].barrelSprite.events.onInputDown.add(listener,gameBoard[i][j]);
	          	gameBoard[i][j].barrelSprite.inputEnabled = false;
	            counter++;
		}
	}
}

function resetBoard() {
	for (var i = 0; i < TEST_CONSTANT; i++) {
			for(var j = 0; j < TEST_CONSTANT; j++) {
				gameBoard[i][j].barrelSprite.loadTexture('spriteInvisBarrel');
				gameBoard[i][j].barrelType = BARREL_EMPTY;
				gameBoard[i][j].visible = false;
				gameBoard[i][j].charges = 3;
		}
		uppdateBarrelVisibility(i, true);
	}
}

function spawnBoard() {
	
	console.log('spawnboard()');

	for (var i = 0; i < TEST_CONSTANT; i++) {
		for(var j = 0; j < TEST_CONSTANT; j++) {
			var barrel;
			var rand = Math.round(Math.random()*9);
			if(rand === 0) {
				barrel = game.add.sprite(i*BARREL_WIDTH, j*BARREL_HEIGHT, 'spriteMoveRowLeft');
				gameBoard[i][j] = new Barrel(BARREL_MOVE_ROW_LEFT, j, i, counter, barrel, 2, false);
                barrel.alpha = false;
			} else if (rand === 1) {
				barrel = game.add.sprite(i*BARREL_WIDTH, j*BARREL_HEIGHT, 'spriteRevealAbove');
				gameBoard[i][j] = new Barrel(BARREL_REVEAL_ABOVE, j, i, counter, barrel, 2, true);
			} else if (rand == 2) {
				barrel = game.add.sprite(i*BARREL_WIDTH, j*BARREL_HEIGHT, 'spriteCharge');
				gameBoard[i][j] = new Barrel(BARREL_CHARGE, j, i, counter, barrel, 2, false);
                barrel.alpha = false;
			} else if (rand == 3) {
				barrel = game.add.sprite(i*BARREL_WIDTH, j*BARREL_HEIGHT, 'spriteMoveRowRight');
				gameBoard[i][j] = new Barrel(BARREL_MOVE_ROW_RIGHT, j, i, counter, barrel, 2, false);
                barrel.alpha = false;
             } else if (rand == 4) {
				barrel = game.add.sprite(i*BARREL_WIDTH, j*BARREL_HEIGHT, 'spriteRevealLeft');
				gameBoard[i][j] = new Barrel(BARREL_REVEAL_LEFT, j, i, counter, barrel, 2, true);
                barrel.alpha = true;
			}  else {
				barrel = game.add.sprite(i*BARREL_WIDTH, j*BARREL_HEIGHT, 'spriteMoveColDown');
				gameBoard[i][j] = new Barrel(BARREL_MOVE_COL_DOWN, j, i, counter, barrel, 2, false);
                barrel.alpha = false;
			}
		
			barrel.inputEnabled = true;

            gameBoard[i][j].barrelSprite.events.onInputDown.add(listener,gameBoard[i][j]);
            if(!gameBoard[i][j].visible)
                gameBoard[i][j].barrelSprite.inputEnabled = false;

            counter++;
		}
	}
}

function listener() {	
	var expr = this.barrelType;
	switch(expr) {
		
		case BARREL_REVEAL_ABOVE:
            if(this.posX == 0 || this.charges <= 0 || gameBoard[this.posY][this.posX-1].visible == true) {
                console.log('If barrel reveal above');
                this.barrelInfo();
                break;
            }
            bClick.play();
			showBarrelAbove(this);
            //this.charges--;
            this.barrelInfo();
			break;

		case BARREL_REVEAL_BELOW:
			if(this.posX == TEST_CONSTANT-1 || this.charges <= 0 ||gameBoard[this.posY][this.posX+1].visible == true) {
				console.log('If barrel reveal below');
				break;
			}
			bClick.play();
			showBarrelBellow(this);
			//this.charges--;
            this.barrelInfo();
			break;
		
		case BARREL_REVEAL_RIGHT:
			if(this.posY == TEST_CONSTANT-1 || this.charges <= 0 ||gameBoard[this.posY+1][this.posX].visible == true) {
				console.log('If barrel reveal RIGHT');
				break;
			}
			bClick.play();
			showBarrelRight(this);
			//this.charges--;
            this.barrelInfo();
			break;
		
		case BARREL_REVEAL_LEFT:
			if(this.posY == 0 || this.charges <= 0 ||gameBoard[this.posY-1][this.posX].visible == true) {
				console.log('If barrel reveal LEFT');
				break;
			}
			bClick.play();
			showBarrelLeft(this);
			//this.charges--;
            this.barrelInfo();
			break;

		case BARREL_MOVE_COL_UP:
			if(this.posY == 0 || this.charges <= 0)
				break;
			moveColUp(this);
			//this.charges--;
            this.barrelInfo();
			break;

		case BARREL_MOVE_COL_DOWN:
			if(this.posY == 0 || this.charges <= 0)
				break;
			moveColDown(this);
			//this.charges--;
			this.barrelInfo();
			break;

		case BARREL_MOVE_ROW_LEFT:
			if(this.posX == TEST_CONSTANT-1 || this.charges <= 0)
				break;
			moveRowLeft(this);
			//this.charges--;
            this.barrelInfo();
			break;

		case BARREL_MOVE_ROW_RIGHT:
			if(this.posX == TEST_CONSTANT-1 || this.charges <= 0)
				break;
			moveRowRight(this);
			//this.charges--;
			this.barrelInfo();
			break;

		case BARREL_CHARGE:
			addCharge(this);
            this.barrelInfo();
			break;
	}
}

function showBarrelRight(tmpBarrel) {
	var row = tmpBarrel.posX;
    var col = tmpBarrel.posY;

    gameBoard[col+1][row].visible = true;
    gameBoard[col+1][row].barrelInfo();
    uppdateBarrelVisibility(col+1, true);
}

function showBarrelLeft(tmpBarrel) {
	var row = tmpBarrel.posX;
    var col = tmpBarrel.posY;

    gameBoard[col-1][row].visible = true;
    gameBoard[col-1][row].barrelInfo();
    uppdateBarrelVisibility(col-1, true);
}

function showBarrelAbove(tmpBarrel) {
    console.log('shwo above!');
    var row = tmpBarrel.posX;
    var col = tmpBarrel.posY;
    
    gameBoard[col][row-1].visible = true;
    gameBoard[col][row-1].barrelInfo();
    uppdateBarrelVisibility(row-1, false);
}

function showBarrelBellow (tmpBarrel) {
	console.log('show bellow!');
	var row = tmpBarrel.posX;
	var col = tmpBarrel.posY;

	gameBoard[col][row+1].visible = true;
	gameBoard[col][row+1].barrelInfo();
	uppdateBarrelVisibility(row+1, false);
}

function moveColUp (tmpBarrel) {
	var col = tmpBarrel.posY-1;
	var row = tmpBarrel.posX;
	var text = gameBoard[col][0].barrelSprite.key;
	var barrel = gameBoard[col][0];
	
	if(winBarrelCol == col && gameBoard[winBarrelCol][winBarrelRow+1].barrelType != BARREL_EMPTY) {
		console.log('WINGINGINGIGNG');
		gameBoard[winBarrelCol][winBarrelRow+1].barrelSprite.loadTexture('spriteInvisBarrel');
		levelComplete();
		return;
	}

	for(var i = 0; i <TEST_CONSTANT-1 ; i++) {
		if(i == TEST_CONSTANT-1) 
			gameBoard[col][i].barrelSprite.loadTexture(text);
		else if(gameBoard[col][i+1].barrelType == BARREL_WIN) {
			gameBoard[col][i].barrelSprite.loadTexture(gameBoard[col][i+2].barrelSprite.key);
			i++;
		} else 
			gameBoard[col][i].barrelSprite.loadTexture(gameBoard[col][i+1].barrelSprite.key);
	}

	var fooType = gameBoard[col][0].barrelType;
    var fooId = gameBoard[col][0].barrelId;
    var fooSprite = gameBoard[col][0].barrelSprite; 
    var fooCharges = gameBoard[col][0].charges;
    var fooVisible = gameBoard[col][0].visible;

    for(var i = 0; i < TEST_CONSTANT; i++) {
		if(i == TEST_CONSTANT-1) {
			gameBoard[col][5].barrelType = fooType;
			gameBoard[col][5].barrelId = fooId;
			gameBoard[col][5].charges = fooCharges;
            gameBoard[col][5].visible = fooVisible;
		} else if(gameBoard[col][i+1].barrelType == BARREL_WIN) {	
        	gameBoard[col][i].barrelType = gameBoard[col][i+2].barrelType;
			gameBoard[col][i].barrelId = gameBoard[col][i+2].barrelId;
			gameBoard[col][i].charges = gameBoard[col][i+2].charges;
            gameBoard[col][i].visible = gameBoard[col][i+2].visible;
            i++;
        }else {
			gameBoard[col][i].barrelType = gameBoard[col][i+1].barrelType;
			gameBoard[col][i].barrelId = gameBoard[col][i+1].barrelId;
			gameBoard[col][i].charges = gameBoard[col][i+1].charges;
            gameBoard[col][i].visible = gameBoard[col][i+1].visible;
		}
	}
    uppdateBarrelVisibility(col, true/*this is col*/);
}

function moveColDown (tmpBarrel) {
	var col = tmpBarrel.posY-1;
	var row = tmpBarrel.posX;
	var text = gameBoard[col][5].barrelSprite.key;
	var barrel = gameBoard[col][5];
	
	if(winBarrelCol == col && gameBoard[winBarrelCol][winBarrelRow-1].barrelType != BARREL_EMPTY) {
		console.log('WINGINGINGIGNG');
		gameBoard[winBarrelCol][winBarrelRow-1].barrelSprite.loadTexture('spriteInvisBarrel');
		levelComplete();
		return;
	}

	for(var i = 5; i >= 0; i--) {
		if(i == 0) 
			gameBoard[col][i].barrelSprite.loadTexture(text);
		else if(gameBoard[col][i-1].barrelType == BARREL_WIN) {
			gameBoard[col][i].barrelSprite.loadTexture(gameBoard[col][i-2].barrelSprite.key);
			i--;
		} else 
			gameBoard[col][i].barrelSprite.loadTexture(gameBoard[col][i-1].barrelSprite.key);
	}

	var fooType = gameBoard[col][5].barrelType;
    var fooId = gameBoard[col][5].barrelId;
    var fooSprite = gameBoard[col][5].barrelSprite; 
    var fooCharges = gameBoard[col][5].charges;
    var fooVisible = gameBoard[col][5].visible;

    for(var i = 5; i >= 0; i--) {
		if(i == 0) {
			gameBoard[col][0].barrelType = fooType;
			gameBoard[col][0].barrelId = fooId;
			gameBoard[col][0].charges = fooCharges;
            gameBoard[col][0].visible = fooVisible;
		} else if(gameBoard[col][i-1].barrelType == BARREL_WIN) {	
        	gameBoard[col][i].barrelType = gameBoard[col][i-2].barrelType;
			gameBoard[col][i].barrelId = gameBoard[col][i-2].barrelId;
			gameBoard[col][i].charges = gameBoard[col][i-2].charges;
            gameBoard[col][i].visible = gameBoard[col][i-2].visible;
            i--;
        }else {
			gameBoard[col][i].barrelType = gameBoard[col][i-1].barrelType;
			gameBoard[col][i].barrelId = gameBoard[col][i-1].barrelId;
			gameBoard[col][i].charges = gameBoard[col][i-1].charges;
            gameBoard[col][i].visible = gameBoard[col][i-1].visible;
		}
	}
    uppdateBarrelVisibility(col, true/*this is col*/);
}

function moveRowRight (tmpBarrel) {

	var col = tmpBarrel.posY;
	var row = tmpBarrel.posX+1;
	var text = gameBoard[5][row].barrelSprite.key;
	var barrelSprite = gameBoard[5][row];

	if(winBarrelRow == row && gameBoard[winBarrelCol-1][winBarrelRow].barrelType != BARREL_EMPTY) {
		console.log('WINGINGINGIGNG');
		gameBoard[winBarrelCol-1][winBarrelRow].barrelSprite.loadTexture('spriteInvisBarrel');
		levelComplete();
		return;
	}
	
	for(var i = 5; i >= 0; i--) {
		if(i == 0) 
			gameBoard[i][row].barrelSprite.loadTexture(text);
		else if(gameBoard[i-1][row].barrelType == BARREL_WIN) {
			gameBoard[i][row].barrelSprite.loadTexture(gameBoard[i-2][row].barrelSprite.key);
			i--;
		} else 
			gameBoard[i][row].barrelSprite.loadTexture(gameBoard[i-1][row].barrelSprite.key);
	}

	var fooType = gameBoard[5][row].barrelType;
    var fooId = gameBoard[5][row].barrelId;
    var fooSprite = gameBoard[5][row].barrelSprite;
    var fooCharges = gameBoard[5][row].charges;
    var fooVisible = gameBoard[5][row].visible;

    for(var i = 5; i >= 0; i--) {
    	
    	if(i == 0) {
    		gameBoard[0][row].barrelType = fooType;
			gameBoard[0][row].barrelId = fooId;
			gameBoard[0][row].charges = fooCharges;
            gameBoard[0][row].visible = fooVisible;
        } else if(gameBoard[i-1][row].barrelType == BARREL_WIN) {	
        	gameBoard[i][row].barrelType = gameBoard[i-2][row].barrelType;
			gameBoard[i][row].barrelId = gameBoard[i-2][row].barrelId;
			gameBoard[i][row].charges = gameBoard[i-2][row].charges;
            gameBoard[i][row].visible = gameBoard[i-2][row].visible;
            i--;
        } else {
        	gameBoard[i][row].barrelType = gameBoard[i-1][row].barrelType;
			gameBoard[i][row].barrelId = gameBoard[i-1][row].barrelId;
			gameBoard[i][row].charges = gameBoard[i-1][row].charges;
            gameBoard[i][row].visible = gameBoard[i-1][row].visible;
        }
    
    }
    uppdateBarrelVisibility(row, false/*this is row*/);

}
function moveRowLeft (tmpBarrel) {
	var col = tmpBarrel.posY;
	var row = tmpBarrel.posX+1;
	var text = gameBoard[0][row].barrelSprite.key;
	var barrel = gameBoard[0][row];
	
	for(var i = 0; i < TEST_CONSTANT-1; i++) {
		if(i == TEST_CONSTANT-1) 
			gameBoard[i][row].barrelSprite.loadTexture(text);
		else if(gameBoard[i+1][row].barrelType == BARREL_WIN) {
			gameBoard[i][row].barrelSprite.loadTexture(gameBoard[i+2][row].barrelSprite.key);
			i++;
		} else 
			gameBoard[i][row].barrelSprite.loadTexture(gameBoard[i+1][row].barrelSprite.key);
	}

    var fooType = gameBoard[0][row].barrelType;
    var fooId = gameBoard[0][row].barrelId;
    var fooSprite = gameBoard[0][row].barrelSprite;
    var fooCharges = gameBoard[0][row].charges;
    var fooVisible = gameBoard[0][row].visible;

	for(var i = 0; i < TEST_CONSTANT; i++) {
		if(i == TEST_CONSTANT-1) {
			gameBoard[5][row].barrelType = fooType;
			gameBoard[5][row].barrelId = fooId;
			gameBoard[5][row].charges = fooCharges;
            gameBoard[5][row].visible = fooVisible;
		} else if(gameBoard[i+1][row].barrelType == BARREL_WIN) {	
        	gameBoard[i][row].barrelType = gameBoard[i+2][row].barrelType;
			gameBoard[i][row].barrelId = gameBoard[i+2][row].barrelId;
			gameBoard[i][row].charges = gameBoard[i+2][row].charges;
            gameBoard[i][row].visible = gameBoard[i+2][row].visible;
            i++;
        } else {
			gameBoard[i][row].barrelType = gameBoard[i+1][row].barrelType;
			gameBoard[i][row].barrelId = gameBoard[i+1][row].barrelId;
			gameBoard[i][row].charges = gameBoard[i+1][row].charges;
            gameBoard[i][row].visible = gameBoard[i+1][row].visible;
		}
	}
    uppdateBarrelVisibility(row, false/*this is row*/);
}

function addCharge (tmpBarrel) {
	console.log('add charge!');
	col = tmpBarrel.posY;
	row = tmpBarrel.posX;

	if(row > 0) {
		gameBoard[col][row-1].charges++;
		console.log('barrel over: ' + col + ',' + (row-1));
	}
	if(row < 5) {
		gameBoard[col][row+1].charges++;
		console.log('barrel under: ' + col + ',' + (row+1));
	}
	if(col > 0) {
		gameBoard[col-1][row].charges++;
		console.log('barrel venster: ' + (col-1) + ',' + row);
	}
	if(col < 5) {
		gameBoard[col+1][row].charges++;
		console.log('barrel hoeger: ' + (col+1) + ',' + row);
	}

}


function uppdateBarrelVisibility(tmpPos, isCol) {
	if(isCol) {
        for(var i = 0; i < TEST_CONSTANT; i++) {
            gameBoard[tmpPos][i].barrelSprite.alpha = gameBoard[tmpPos][i].visible;
            gameBoard[tmpPos][i].barrelSprite.inputEnabled = gameBoard[tmpPos][i].visible;
        }
    } else {
        for(var i = 0; i < TEST_CONSTANT; i++) {
            gameBoard[i][tmpPos].barrelSprite.alpha = gameBoard[i][tmpPos].visible;
            gameBoard[i][tmpPos].barrelSprite.inputEnabled = gameBoard[i][tmpPos].visible;
        }
    }
}

function printRow(rowId) {
	for (var i = 0; i < TEST_CONSTANT; i++) {
   		gameBoard[i][rowId].barrelInfo();
   	}
}

function printCol(colId) {

   	for (var i = 0; i < TEST_CONSTANT; i++) {
   		gameBoard[colId][i].barrelInfo();
   	}
}

function printBoard() {
	for (var j = 0; j < TEST_CONSTANT; j++) {
   	    for (var k = 0; k < TEST_CONSTANT; k++) {
   			gameBoard[j][k].barrelInfo();

   		}
   	}
}
</script>
<div id="gameCentered"></div>
</body>
</html>